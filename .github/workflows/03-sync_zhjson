name: 03 è‡ªåŠ¨åŒæ­¥æ±‰åŒ–æ–‡ä»¶

on:
  # æ¯å¤©åŒ—äº¬æ—¶é—´æ—©ä¸Š 8:00 (UTC 0:00) æ‰§è¡Œæ£€æŸ¥
  schedule:
    - cron: "0 0 * * *"
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

permissions:
  contents: write

jobs:
  sync-translation:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºæœ¬åœ°ä»“åº“
        uses: actions/checkout@v4

      - name: ä¸‹è½½ä¸Šæ¸¸ zh.json
        run: |
          # ä½¿ç”¨ curl ä¸‹è½½ TC999 çš„æœ€æ–° raw æ–‡ä»¶
          curl -o zh.json.new https://raw.githubusercontent.com/TC999/zed-loc/main/zh.json
          
          echo "â¬‡ï¸ å·²ä¸‹è½½æœ€æ–°æ–‡ä»¶"

      - name: éªŒè¯ JSON æ ¼å¼ (å®‰å…¨æ£€æŸ¥)
        run: |
          # å¦‚æœä¸‹è½½çš„æ–‡ä»¶ä¸æ˜¯åˆæ³•çš„ JSONï¼Œè¿™ä¸€æ­¥ä¼šæŠ¥é”™å¹¶åœæ­¢ï¼Œé˜²æ­¢ç ´åæœ¬åœ°æ–‡ä»¶
          if jq empty zh.json.new > /dev/null 2>&1; then
            echo "âœ… JSON æ ¼å¼éªŒè¯é€šè¿‡"
          else
            echo "âŒ ä¸‹è½½çš„æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œç»ˆæ­¢åŒæ­¥ï¼"
            exit 1
          fi

      - name: å¯¹æ¯”å¹¶æäº¤æ›´æ–°
        id: check_changes
        run: |
          # å¦‚æœæ–‡ä»¶æœ‰å˜åŒ–ï¼ˆdiff è¿”å›é 0ï¼‰ï¼Œåˆ™è¿›è¡Œè¦†ç›–å’Œæäº¤
          if ! cmp -s zh.json zh.json.new; then
            echo "ğŸ”„ å‘ç°ç¿»è¯‘æ›´æ–°ï¼Œæ­£åœ¨è¦†ç›–..."
            mv zh.json.new zh.json
            
            # é…ç½® Git
            git config --local user.name "github-actions[bot]"
            git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
            
            git add zh.json
            git commit -m "Auto-sync: Update zh.json from TC999/zed-loc"
            git push
            echo "ğŸš€ æ¨é€æˆåŠŸï¼"
          else
            echo "ğŸ’¤ ç¿»è¯‘æ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡ã€‚"
            rm zh.json.new
          fi
